## 内存管理

- [Go垃圾回收之三色标记算法](https://cloud.tencent.com/developer/article/1608932)

#### 常见的GC模式

- 引用计数(销毁引用,计数器-1,为0,回收)
- 标记清除(mark and sweep) 缺点:每次GC需要暂停所有的运行代码(go1.5之前使用),(go1.5之后使用)变种"三色标记"
- 分代搜集

####  内存泄漏

- 堆内存泄漏(使用内存后未释放)
- 系统资源泄漏(使用后未关闭句柄)

#### GC调优

- 减少对象的分配(对象重用)

#### go程序内存占用大的问题

- 是go的垃圾回收有个触发阈值,这次是4M,gc百分比参数是100,下次触发gc是8M
- 操作系统"拖延症"策略
- 每次申请1M的内存,然后分割成不同大小的span,给对象使用,不使用的5分钟后交还系统

#### 对齐规则

[内存对齐](https://mp.weixin.qq.com/s/Q6zFis9BcbQDITs_kXvDsg)

- 结构体的成员变量： 编译器默认对齐长度  和 当前成员变量类型的长度（unsafe.Sizeof） 这2者间取最小值作为当前类型的对齐值。其偏移量必须为对齐值的整数倍
  
- 结构体本身：编译器默认对齐长度 和 结构体的所有成员变量类型中的最大长度 这2者间 取最大数的最小整数倍作为对齐值

- 结合以上两点，可得知若编译器默认对齐长度（#pragma pack(n)）超过结构体内成员变量的类型最大长度时，默认对齐长度是没有任何意义的

