# 协程

## 协程池

- [ants](https://github.com/panjf2000/ants)
- [tunny](https://github.com/Jeffail/tunny)
- [pool](https://github.com/go-playground/pool)

## goroutine 调度时机有哪些
- go 创建一个新的 goroutine，Go scheduler 会考虑调度
- GC
- 系统调用
- 内存同步访问：atomic，mutex，channel 操作等会使 goroutine 阻塞，因此会被调度走。

## goroutine和线程的区别
- 内存占用：一个 goroutine 的栈内存消耗为 2 KB，栈空间不够用，会自动进行扩容。一个 thread 则需要消耗 1 MB 栈内存。
- 创建和销毀：Thread 创建和销毀都会有巨大的消耗，因为要和操作系统打交道，是内核级的，通常解决的办法就是线程池。而 goroutine 因为是由 Go runtime 负责管理的，创建和销毁的消耗非常小，是用户级。
- 切换：当 threads 切换时，需要保存各种寄存器，以便将来恢复。而 goroutines 切换只需保存三个寄存器：Program Counter, Stack Pointer and BP。一般而言，线程切换会消耗 1000-1500 纳秒，Goroutine 的切换约为 200 ns。